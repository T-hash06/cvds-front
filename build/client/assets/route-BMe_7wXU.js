import{r as t,j as e}from"./jsx-runtime-DtbKUkqS.js";import{a as p}from"./axios-2aYz4xwk.js";import{B as i,j as $,k as B,l as k,n as d,t as V,a as W,b as u,c as X,d as Y,e as h,p as Z,Q as ee,m as T,f as O,g as I,h as z,i as M}from"./ReactToastify-DsUNwl2o.js";import{n as ae}from"./index-vU54yuje.js";import{b as l,i as r}from"./chunk-IR2E3HZF-CKWO4TGO.js";import"./context-Cx_DuriG.js";const g="http://localhost:8080",ne=()=>{const[q,L]=t.useState([]),[m,w]=t.useState(""),[E,S]=t.useState("autor"),[f,C]=t.useState(1),[y]=t.useState(5),[F,P]=t.useState(0),[R,v]=t.useState(!1),[G,N]=t.useState(!1),[o,_]=t.useState(null),[s,n]=t.useState({nombreLibro:"",autor:"",editor:"",edicion:"",isbn:"",sinopsis:"",anioPublicacion:""}),A=ae();t.useEffect(()=>{m?j():x()},[f]);const x=async()=>{try{const a=await p.get(`${g}/libros`,{params:{page:f-1,size:y}});L(a.data.content),P(a.data.totalPages),i.success("Libros cargados satisfactoriamente")}catch(a){console.error("Error al obtener libros:",a),i.error("No se pudo cargar los libros")}},j=async()=>{try{const a=await p.get(`${g}/busquedas/${m}/parametro/${E}/pagina/${f-1}/tamano/${y}`);L(a.data.content),P(a.data.totalPages),i.success("Búsqueda realizada satisfactoriamente")}catch(a){console.error("Error al buscar libros:",a),i.error("No se pudo realizar la búsqueda")}},H=()=>{w(""),S("autor"),C(1),x(),i.info("Filtros restablecidos")},Q=async a=>{try{await p.delete(`${g}/libros/${a}`),m?j():x(),i.success("Libro eliminado satisfactoriamente")}catch(c){console.error("Error al eliminar el libro:",c),i.error("No se pudo eliminar el libro")}},U=a=>{_(a),N(!0)},b=(a,c)=>{o&&_({...o,[a]:c})},D=async()=>{if(o)try{await p.put(`${g}/libros/${o.id}`,o),N(!1),_(null),m?j():x(),i.success("Libro editado satisfactoriamente")}catch(a){console.error("Error al editar el libro:",a),i.error("No se pudo editar el libro")}},J=async()=>{try{const a={...s,categorias:[],subcategorias:[],ejemplares:[]};await p.post(`${g}/libros`,a),v(!1),n({nombreLibro:"",autor:"",editor:"",edicion:"",isbn:"",sinopsis:"",anioPublicacion:""}),m?(C(1),j()):x(),i.success("Libro añadido satisfactoriamente")}catch(a){console.error("Error al añadir el libro:",a),i.error("No se pudo añadir el libro")}},K=a=>e.jsxs($,{children:[e.jsx(B,{children:e.jsx(l,{isIconOnly:!0,size:"sm",className:"button-primary",children:"⋮"})}),e.jsxs(k,{onAction:c=>{c==="edit"?U(a):c==="delete"?window.confirm(`¿Estás seguro de eliminar "${a.nombreLibro}"?`)&&Q(a.id):c==="ejemplares"?A(`/books/ejemplares/${a.id}`):c==="categorias"&&A(`/books/categorias/${a.id}`)},children:[e.jsx(d,{children:"Editar"},"edit"),e.jsx(d,{children:"Eliminar"},"delete"),e.jsx(d,{children:"Ejemplares"},"ejemplares"),e.jsx(d,{children:"Categorías"},"categorias")]})]});return e.jsxs("div",{className:"p-6 bg-blue-50 min-h-screen",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-blue-700",children:"Gestión de Libros"}),e.jsx(l,{className:"button-primary",onClick:()=>v(!0),children:"Añadir Libro"})]}),e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx(r,{className:"input-search",placeholder:"Buscar...",value:m,onChange:a=>w(a.target.value)}),e.jsxs($,{children:[e.jsx(B,{children:e.jsx(l,{className:"button-primary",children:`Buscar por: ${E}`})}),e.jsxs(k,{onAction:a=>S(a),children:[e.jsx(d,{children:"Autor"},"autor"),e.jsx(d,{children:"Título"},"nombreLibro"),e.jsx(d,{children:"ISBN"},"isbn"),e.jsx(d,{children:"Sinopsis"},"sinopsis")]})]}),e.jsx(l,{className:"button-primary",onClick:j,children:"Buscar"}),e.jsx(l,{className:"button-secondary",onClick:H,children:"Borrar filtros"})]}),e.jsxs(V,{"aria-label":"Lista de libros",children:[e.jsxs(W,{children:[e.jsx(u,{className:"table-header",children:"Título"}),e.jsx(u,{className:"table-header",children:"Autor"}),e.jsx(u,{className:"table-header",children:"Editor"}),e.jsx(u,{className:"table-header",children:"Edición"}),e.jsx(u,{className:"table-header w-auto",children:"ISBN"}),e.jsx(u,{className:"table-header",children:"Sinopsis"}),e.jsx(u,{className:"table-header",children:"Año"}),e.jsx(u,{className:"table-header",children:"Acciones"})]}),e.jsx(X,{children:q.map(a=>e.jsxs(Y,{className:"table-row",children:[e.jsx(h,{children:a.nombreLibro}),e.jsx(h,{children:a.autor}),e.jsx(h,{children:a.editor}),e.jsx(h,{children:a.edicion}),e.jsx(h,{className:"whitespace-nowrap w-auto",children:a.isbn}),e.jsx(h,{children:a.sinopsis}),e.jsx(h,{children:a.anioPublicacion}),e.jsx(h,{children:K(a)})]},a.id))})]}),e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx(Z,{total:F,page:f,onChange:a=>C(a)})}),e.jsx(ee,{position:"top-right",autoClose:3e3,hideProgressBar:!0,newestOnTop:!0,closeOnClick:!0,pauseOnHover:!0,draggable:!0}),e.jsx(T,{isOpen:R,onOpenChange:v,children:e.jsxs(O,{children:[e.jsx(I,{children:e.jsx("h2",{children:"Añadir Nuevo Libro"})}),e.jsxs(z,{children:[e.jsx(r,{label:"Título",value:s.nombreLibro,onChange:a=>n({...s,nombreLibro:a.target.value})}),e.jsx(r,{label:"Autor",value:s.autor,onChange:a=>n({...s,autor:a.target.value})}),e.jsx(r,{label:"Editor",value:s.editor,onChange:a=>n({...s,editor:a.target.value})}),e.jsx(r,{label:"Edición",value:s.edicion,onChange:a=>n({...s,edicion:a.target.value})}),e.jsx(r,{label:"ISBN",value:s.isbn,onChange:a=>n({...s,isbn:a.target.value})}),e.jsx(r,{label:"Sinopsis",value:s.sinopsis,onChange:a=>n({...s,sinopsis:a.target.value})}),e.jsx(r,{label:"Año de Publicación",value:s.anioPublicacion,onChange:a=>n({...s,anioPublicacion:a.target.value})})]}),e.jsxs(M,{children:[e.jsx(l,{className:"button-primary",onClick:J,children:"Confirmar"}),e.jsx(l,{className:"button-secondary",onClick:()=>v(!1),children:"Cancelar"})]})]})}),o&&e.jsx(T,{isOpen:G,onOpenChange:N,children:e.jsxs(O,{children:[e.jsx(I,{children:e.jsx("h2",{children:"Editar Libro"})}),e.jsxs(z,{children:[e.jsx(r,{label:"Título",value:o.nombreLibro,onChange:a=>b("nombreLibro",a.target.value)}),e.jsx(r,{label:"Autor",value:o.autor,onChange:a=>b("autor",a.target.value)}),e.jsx(r,{label:"Editor",value:o.editor,onChange:a=>b("editor",a.target.value)}),e.jsx(r,{label:"Edición",value:o.edicion,onChange:a=>b("edicion",a.target.value)}),e.jsx(r,{label:"ISBN",value:o.isbn,onChange:a=>b("isbn",a.target.value)}),e.jsx(r,{label:"Sinopsis",value:o.sinopsis,onChange:a=>b("sinopsis",a.target.value)}),e.jsx(r,{label:"Año de Publicación",value:o.anioPublicacion,onChange:a=>b("anioPublicacion",a.target.value)})]}),e.jsxs(M,{children:[e.jsx(l,{className:"button-primary",onClick:D,children:"Confirmar"}),e.jsx(l,{className:"button-secondary",onClick:()=>N(!1),children:"Cancelar"})]})]})})]})};export{ne as default};
